<!DOCTYPE html>
<html>
<head>
    <title>Messagerie Gremont</title>
    <link rel="stylesheet" href="Messagerie.css">
</head>
<body>

      <!-- Formulaire de connexion-->
      <section class="login">
          <div class="FormulaireConnexion" id="FormulaireConnexion"> 
            <form id="Connexion" method="POST" onsubmit="return false">
                <label for="usernameConnexion">Nom d'utilisateur</label>
                  <input type="text" id="usernameConnexion"name="usernameConnexion" placeholder="Votre nom d'utilisateur">
                
                <label for="passwordConnexion">Mot de passe</label>
                  <input type="password" id="passwordConnexion" name="passwordConnexion" placeholder="Votre mot de passe">
                  <button id="ShowConnexion" onclick="afficheInscription()">Page Inscription</button>
                <button type="submit" onclick="connexion()">Connexion</button>
            </form>
          </div>
      </section>
      
      <!--   Formulaire d'incription-->
      <section class="inscription">
        <div class="FormulaireInscription" id="FormulaireInscription"> 
          <form id="Inscription" method="POST" onsubmit="return false">
                  <label for="usernameInscription">Nom d'utilisateur</label>
                      <input type="text" id="usernameInscription"name="usernameInscription" placeholder="Votre nom d'utilisateur">
        
                  <label for="passwordInscription">Mot de passe</label>
                      <input type="password" id="passwordInscription" name="passwordInscription" placeholder="Votre mot de passe">
                      <input type="password" id="ConfirmpasswordInscription" name="ConfirmpasswordInscription" placeholder="Entrer à nouveaux votre mot de passe">
              <button id="ShowInscription" onclick="afficheConnexion()">Page Connexion</button>
              <button type="submit" onclick="inscription()">Inscription</button>
          </form>
        </div>
      </section>

    <div class="MessageBox">
        <ul id="Message"></ul>
        <form id="form" onsubmit="return false">
          <input id="textBox" rows="2" cols="45" maxlength="180" oninput="auto_height(this)" /><button onclick="sendText(UserCorrect)">Envoyer</button><button onclick="getText(UserCorrect)">Actualiser</button>
        </form>
    </div>


</body>

<script>

  let UserCorrect = "jetebz";

</script>

<script src="WebSocket.js"></script>
<script>

    
    /* Fonction pour faire apparaitre le formulaire de connexion*/
    function afficheConnexion(){
    document.querySelector('.login').style.display='flex';
    document.querySelector('.inscription').style.display='none';
    }

    /* Fonction pour faire apparaitre le formulaire d'incription*/
    function afficheInscription(){
    document.querySelector('.login').style.display='none';
    document.querySelector('.inscription').style.display='flex';
    }
  




  function auto_height(elem) {  
    elem.style.height = "75%";
    elem.style.height = (elem.scrollHeight)+"px";
  }



  function inscription() {
    VerifUsername = document.getElementById("usernameInscription").value;
    VerifPassword =  document.getElementById("passwordInscription").value;
    VerifConfirmPassword =  document.getElementById("ConfirmpasswordInscription").value;

    if(VerifUsername == ""){

      alert("Veulillez rentrer un nom d'utilisateur");

    }else if (VerifPassword == "" || VerifConfirmPassword == ""){

      alert("Certain champ de mot de passe ne sont pas remplies")

    }else if(VerifPassword != VerifConfirmPassword){

      alert("Les mots de passes ne sont pas les mêmes")

    }else{

      /*Je convertis mes information en JSON (Le résultat donne un tableaux)*/
      var inscription = [{
        Method: 3,
        username: document.getElementById("usernameInscription").value,
        password: document.getElementById("passwordInscription").value,
        
      }];
    
      /*Envoie du Message JSON vers le serveur WebSocket*/
      socket.send(JSON.stringify(inscription));

      return false;
    }
  }



function connexion() {
    VerifUsername = document.getElementById("usernameConnexion").value;
    VerifPassword =  document.getElementById("passwordConnexion").value;

  if(VerifUsername == ""){

    alert("Veulillez rentrer un nom d'utilisateur");

  }else if (VerifPassword == "" ){

    alert("Veulillez rentrer un mot de passe");

  }else{
    /*Je convertis mes information en JSON (Le résultat donne un tableaux)*/
    var userconnexion = [{
      Method: 1,
      username: document.getElementById("usernameConnexion").value,
      password: document.getElementById("passwordConnexion").value,
        
    }];

    /*Envoie du Message JSON vers le serveur WebSocket*/
    socket.send(JSON.stringify(userconnexion));
    getText(UserCorrect);

    return false;
  }
}


var Chat = document.getElementById('Message');


function sendText(UserCorrect) {

  /*Je convertis mes information en JSON (Le résultat donne un tableaux)*/
  var msg = [{
    "Method": 2,
    "username" : UserCorrect,
    "message" : document.getElementById("textBox").value,
  }];
  
  /*Je vérifie que l'utilisateur est connecté*/
  if( UserCorrect ){

    /*J'envoie le message au format JSON au serveur afin qu'il puisse être stocké en BDD*/
    socket.send(JSON.stringify(msg));

    /*Je crée chaque message comme un 'li' afin de les afficher facilement dans une liste*/
    var MessageListe = document.createElement('li');

    /*J'affecte mon User et son message dans une variable*/
    MessageListe.textContent = msg.username + " : " + msg.message;

    /*
      Chat = document.getElementById('Message')
      Je crée une nouvelle ligne dans ma liste a chaque
    */
    Chat.appendChild(MessageListe);
    window.scrollTo(0, document.body.scrollHeight);

  }else{
    alert('Veulliez vous connecter pour commencer un chat');
  }
  
  document.getElementById("textBox").value = "";

  return false;
}

function getText(UserCorrect) {

/*Je convertis mes information en JSON (Le résultat donne un tableaux)*/
var msg = [{
  "Method": 4,
  "username" : UserCorrect,
}];

var myList = document.getElementById('Message');
myList.innerHTML = '';
socket.send(JSON.stringify(msg));

return false;
}

</script>
</html>